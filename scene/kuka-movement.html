<a-box id="plate" visible="true" position="-0.0847598285486445 2.482928401314651 -1.4860096507371743" rotation="0 0 0"
       scale="2.8454860635065806 0.5761209236374649 0.011858087159786961"
       material="alphaTest:0;depthTest:true;depthWrite:true;flatShading:false;npot:false;offset:0 0 ;opacity:1;repeat:1 1 ;shader:standard;side:front;transparent:false;vertexColors:none;visible:true;blending:normal;dithering:true;ambientOcclusionMapIntensity:1;ambientOcclusionTextureOffset:0 0 ;ambientOcclusionTextureRepeat:1 1 ;color:#FFF;displacementScale:1;displacementBias:0.5;displacementTextureOffset:0 0 ;displacementTextureRepeat:1 1 ;emissive:#000;emissiveIntensity:1;fog:true;height:256;metalness:0;metalnessTextureOffset:0 0 ;metalnessTextureRepeat:1 1 ;normalScale:1 1 ;normalTextureOffset:0 0 ;normalTextureRepeat:1 1 ;roughness:0.5;roughnessTextureOffset:0 0 ;roughnessTextureRepeat:1 1 ;width:512;wireframe:false;wireframeLinewidth:2;"
       geometry="primitive:box;buffer:true;skipCache:false;depth:1;height:1;width:1;segmentsHeight:1;segmentsWidth:1;segmentsDepth:1;">
    <a-image id="wrl" visible="true" position="0.24960695715326928 -0.039536136123190686 1.4287731699065631"
             rotation="0 0 0" scale="0.3365778173918554 0.560678216065049 0.3365778173918554"
             material="color:#FFF;shader:flat;side:double;transparent:true;src:/assets/public/models/3DP-2/wrl;alphaTest:0;depthTest:true;depthWrite:true;flatShading:false;npot:false;offset:0 0 ;opacity:1;repeat:1 1 ;vertexColors:none;visible:true;blending:normal;dithering:true;fog:true;height:256;width:512;wireframe:false;wireframeLinewidth:2;"
             geometry="primitive:plane;buffer:true;skipCache:false;height:1;width:1;segmentsHeight:1;segmentsWidth:1;"></a-image>
    <a-image id="kist" visible="true" position="-0.14389264513511602 -0.010809066971680444 1.8688286045340448"
             rotation="0 0 0" scale="0.47240591815067495 0.7364825182491723 84.33063330746893"
             material="color:#FFF;shader:flat;side:double;transparent:true;src:/assets/public/models/3DP-2/kist;alphaTest:0;depthTest:true;depthWrite:true;flatShading:false;npot:false;offset:0 0 ;opacity:1;repeat:1 1 ;vertexColors:none;visible:true;blending:normal;dithering:true;fog:true;height:256;width:512;wireframe:false;wireframeLinewidth:2;"
             geometry="primitive:plane;buffer:true;skipCache:false;height:1;width:1;segmentsHeight:1;segmentsWidth:1;"></a-image>
</a-box>
<a-box id="plate2" visible="true" position="-0.0847598285486445 3.1478086095805793 -1.4860096507371743" rotation="0 0 0"
       scale="2.8454860635065806 0.5761209236374649 0.011858087159786961"
       material="alphaTest:0;depthTest:true;depthWrite:true;flatShading:false;npot:false;offset:0 0 ;opacity:1;repeat:1 1 ;shader:standard;side:front;transparent:false;vertexColors:none;visible:true;blending:normal;dithering:true;ambientOcclusionMapIntensity:1;ambientOcclusionTextureOffset:0 0 ;ambientOcclusionTextureRepeat:1 1 ;color:#FFF;displacementScale:1;displacementBias:0.5;displacementTextureOffset:0 0 ;displacementTextureRepeat:1 1 ;emissive:#000;emissiveIntensity:1;fog:true;height:256;metalness:0;metalnessTextureOffset:0 0 ;metalnessTextureRepeat:1 1 ;normalScale:1 1 ;normalTextureOffset:0 0 ;normalTextureRepeat:1 1 ;roughness:0.5;roughnessTextureOffset:0 0 ;roughnessTextureRepeat:1 1 ;width:512;wireframe:false;wireframeLinewidth:2;"
       geometry="primitive:box;buffer:true;skipCache:false;depth:1;height:1;width:1;segmentsHeight:1;segmentsWidth:1;segmentsDepth:1;">
    <a-image id="ams" visible="true" position="-0.01671963749064608 -0.011764824334523395 0.856838648979526"
             rotation="0 0 0" scale="0.49819579293299454 0.5031910004283845 0.8159174805599535"
             material="color:#FFF;shader:flat;side:double;transparent:true;alphaTest:0;depthTest:true;depthWrite:true;flatShading:false;npot:false;offset:0 0 ;opacity:1;repeat:1 1 ;vertexColors:none;visible:true;blending:normal;dithering:true;fog:true;height:256;src:/assets/public/models/3DP-2/ams;width:512;wireframe:false;wireframeLinewidth:2;"
             geometry="primitive:plane;buffer:true;skipCache:false;height:1;width:1;segmentsHeight:1;segmentsWidth:1;"></a-image>
</a-box>
<a-light id="l2" visible="true" position="-0.020451175567193725 3.068309040979295 -0.6990088462907511"
         rotation="-77.45957864109272 0 -1.4033418597069755e-14" scale="1 1 1"
         light="angle:60;color:#FFF;groundColor:#FFF;decay:1;distance:0;intensity:1;penumbra:0;type:spot;target:null;castShadow:false;shadowBias:0;shadowCameraFar:500;shadowCameraFov:90;shadowCameraNear:0.5;shadowCameraTop:5;shadowCameraRight:5;shadowCameraBottom:-5;shadowCameraLeft:-5;shadowCameraVisible:false;shadowMapHeight:512;shadowMapWidth:512;shadowRadius:1;"></a-light>
<a-entity visible="true" position="0 0 0" rotation="0 0 0" scale="1 1 1"
          light="color:#BBB;type:ambient;angle:60;groundColor:#FFF;decay:1;distance:0;intensity:1;penumbra:0;target:null;castShadow:false;shadowBias:0;shadowCameraFar:500;shadowCameraFov:90;shadowCameraNear:0.5;shadowCameraTop:5;shadowCameraRight:5;shadowCameraBottom:-5;shadowCameraLeft:-5;shadowCameraVisible:false;shadowMapHeight:512;shadowMapWidth:512;shadowRadius:1;"></a-entity>
<a-entity visible="true" position="-0.5 1 1" rotation="0 0 0" scale="1 1 1"
          light="color:#FFF;intensity:0.6;castShadow:true;angle:60;groundColor:#FFF;decay:1;distance:0;penumbra:0;type:directional;target:null;shadowBias:0;shadowCameraFar:500;shadowCameraFov:90;shadowCameraNear:0.5;shadowCameraTop:5;shadowCameraRight:5;shadowCameraBottom:-5;shadowCameraLeft:-5;shadowCameraVisible:false;shadowMapHeight:512;shadowMapWidth:512;shadowRadius:1;"></a-entity>
<a-gltf-model id="R1" visible="true" position="0 -0.018850568057123596 0" rotation="0 0 0" scale="1 1 1"
              gltf-model="/assets/public/models/3DP-2/A00">
    <a-gltf-model id="R2" visible="true" position="-0.7278840421161483 0.5492522988399889 0"
                  rotation="0 5.879955027062009 0" scale="1 1 1" gltf-model="/assets/public/models/3DP-2/A1">
        <a-gltf-model id="R3" visible="true" position="0.17474982371293113 0.38305620532773865 0.10627493734599489"
                      rotation="0 0 -12.752984839316909" scale="1 1 1" gltf-model="/assets/public/models/3DP-2/A2">
            <a-gltf-model id="R4" visible="true"
                          position="-0.0010221898802179052 0.8900393514394257 0.08505477785700832"
                          rotation="0 0 -32.279403943932294" scale="1 1 1" gltf-model="/assets/public/models/3DP-2/A3">
                <a-gltf-model id="R5" visible="true"
                              position="0.33607262496159696 0.049798841507509906 -0.18943816106415523"
                              rotation="-171.718052101175 0 0" scale="1 1 1"
                              gltf-model="/assets/public/models/3DP-2/A4">
                    <a-gltf-model id="R6" visible="true"
                                  position="0.6980597931387028 -0.00019149998094780685 -0.032035759918995"
                                  rotation="0 0 -45.33271257141894" scale="1 1 1"
                                  gltf-model="/assets/public/models/3DP-2/A5">
                        <a-gltf-model id="R7" visible="true"
                                      position="0.13236172265102697 0.00022515277968349068 0.03189921179578014"
                                      rotation="174.1573295677078 0 0" scale="1 1 1"
                                      gltf-model="/assets/public/models/3DP-2/A6">
                            <a-sphere id="endpoint" visible="true" position="0.2362315084046575 -0.25222634851991876 0"
                                      rotation="0 0 0" scale="0.0001 0.0001 0.0001"
                                      material="alphaTest:0;depthTest:true;depthWrite:true;flatShading:false;npot:false;offset:0 0 ;opacity:1;repeat:1 1 ;shader:standard;side:front;transparent:false;vertexColors:none;visible:true;blending:normal;dithering:true;ambientOcclusionMapIntensity:1;ambientOcclusionTextureOffset:0 0 ;ambientOcclusionTextureRepeat:1 1 ;color:#FFF;displacementScale:1;displacementBias:0.5;displacementTextureOffset:0 0 ;displacementTextureRepeat:1 1 ;emissive:#000;emissiveIntensity:1;fog:true;height:256;metalness:0;metalnessTextureOffset:0 0 ;metalnessTextureRepeat:1 1 ;normalScale:1 1 ;normalTextureOffset:0 0 ;normalTextureRepeat:1 1 ;roughness:0.5;roughnessTextureOffset:0 0 ;roughnessTextureRepeat:1 1 ;width:512;wireframe:false;wireframeLinewidth:2;"
                                      geometry="primitive:sphere;buffer:true;skipCache:false;radius:1;phiLength:360;phiStart:0;thetaLength:180;thetaStart:0;segmentsHeight:18;segmentsWidth:36;"></a-sphere>
                        </a-gltf-model>
                    </a-gltf-model>
                </a-gltf-model>
            </a-gltf-model>
        </a-gltf-model>
    </a-gltf-model>
</a-gltf-model>
<a-gltf-model id="P1" visible="true" position="-0.016597939637055137 -0.004765979734035086 0" rotation="0 0 0"
              scale="1 1 1" gltf-model="/assets/public/models/3DP-2/P1">
    <a-gltf-model id="P2" visible="true" position="0.9777473821624854 0.5555759925107734 0" rotation="0 0 0"
                  scale="1 1 1" gltf-model="/assets/public/models/3DP-2/P2">
        <a-gltf-model id="P3" visible="true" position="-0.24508442099442107 0.11160144519365689 0" rotation="0 0 0"
                      scale="1 1 1" gltf-model="/assets/public/models/3DP-2/P3">
            <a-entity id="pixelContainer" visible="true" position="0 0 0" rotation="0 0 0" scale="1 1 1"></a-entity>
            <a-gltf-model id="P4" visible="true" position="0 -0.02221133918176993 0" rotation="0 0 0" scale="1 1 1"
                          gltf-model="/assets/public/models/3DP-2/P4"></a-gltf-model>
        </a-gltf-model>
    </a-gltf-model>
</a-gltf-model>
<a-gltf-model id="B1" visible="true" position="0 0 0" rotation="0 0 0" scale="1 1 1"
              gltf-model="/assets/public/models/3DP-2/B1"></a-gltf-model>
<a-gltf-model id="wh" visible="true" position="-0.08068385336220629 -0.3087145697955491 -14.557297692271023"
              rotation="0 0 0" scale="0.8 0.8 0.8" gltf-model="/assets/public/models/3DP/wh"></a-gltf-model>
<a-sky id="sky" visible="true" position="0 0 0" rotation="0 0 0" scale="1 1 1"
       material="color:#34342A;side:back;shader:flat;npot:true;alphaTest:0;depthTest:true;depthWrite:true;flatShading:false;offset:0 0 ;opacity:1;repeat:1 1 ;transparent:false;vertexColors:none;visible:true;blending:normal;dithering:true;fog:true;height:256;width:512;wireframe:false;wireframeLinewidth:2;"
       geometry="primitive:sphere;radius:500;segmentsWidth:64;segmentsHeight:32;buffer:true;skipCache:false;phiLength:360;phiStart:0;thetaLength:180;thetaStart:0;"></a-sky>
<a-light id="l1" visible="true" position="0.64345720148001 2.9025535191830327 0" rotation="0 0 0" scale="1 1 1"
         light="angle:60;color:#FFF;groundColor:#FFF;decay:1;distance:0;intensity:1;penumbra:0;type:point;target:null;castShadow:false;shadowBias:0;shadowCameraFar:500;shadowCameraFov:90;shadowCameraNear:0.5;shadowCameraTop:5;shadowCameraRight:5;shadowCameraBottom:-5;shadowCameraLeft:-5;shadowCameraVisible:false;shadowMapHeight:512;shadowMapWidth:512;shadowRadius:1;"></a-light>
<a-gltf-model id="P0" visible="true" position="0.717292254310131 0.8883114716059303 0.0013328726427634366"
              rotation="0 0 90" scale="1 1 1" gltf-model="/assets/public/models/3DP-3/55" collidable=""></a-gltf-model>
<a-painting id="paint" visible="true" position="0 0 0" rotation="0 0 0" scale="1 1 1"
            vr-painting="paintingTarget:true;brushSize:0.01;brushColor:#ef2d5e;"></a-painting>

<script>
    AFRAME.registerComponent("pixel-animation", {
        schema: {
            interval: {type: "number", default: 300},
            duration: {type: "number", default: 1000000},
        },
        init: function () {
            this.container = document.querySelector("#pixelContainer");
            this.endpoint = document.querySelector("#endpoint");
            this.nextPixelTime = 1000;
            this.totalPixels = this.data.duration / this.data.interval;
            this.pixelsCreated = 0;
        },
        tick: function (time) {
            if (this.pixelsCreated >= this.totalPixels) {
                return;
            }
            if (time >= this.nextPixelTime) {
                this.createPixel();
                this.nextPixelTime += this.data.interval;
                this.pixelsCreated += 1;
            }
        },
        createPixel: function () {
            this.endpoint.object3D.updateMatrixWorld(true);
            var endpointPosition = new THREE.Vector3();
            this.endpoint.object3D.getWorldPosition(endpointPosition);

            //var pixel = document.createElement("a-sphere");
            var pixel = document.createElement("a-box");

            // Convert world position to local position
            endpointPosition = this.container.object3D.worldToLocal(endpointPosition);
            pixel.setAttribute("position", endpointPosition);

            //pixel.setAttribute("radius", 0.0015);


            pixel.setAttribute("width", 0.002);
            pixel.setAttribute("height", 0.002);
            pixel.setAttribute("depth", 0.002);
            //pixel.setAttribute("material", "shader: flat; color: grey");
            pixel.setAttribute("material", "color: grey");
            this.container.appendChild(pixel);
        },
    });

    AFRAME.registerComponent("robot-animation", {
        init: function () {
            this.parts = ["R2", "R3", "R4", "R5", "R6", "R7"];
            this.rotationData = [
                [0.2210906088390546, -72.49800985935886, 127.36680084667941, -179.729664676121, 54.869091130446066, 179.84443570417923],
                [0.21434038931313348, -72.47057585498764, 127.32782287349328, -179.73788120554602, 54.85752923463628, 179.84912069025387],
                [0.2038407672384662, -72.44412911808168, 127.2902338549847, -179.75068709965748, 54.846360086650115, 179.85645226986588],
                [0.1899744793932077, -72.41899731489765, 127.25450127236533, -179.76761628815038, 54.83572583569783, 179.8661644578144],
                [0.17267815731331887, -72.39568167670836, 127.22134004917149, -179.78874813656932, 54.82584175486084, 179.87830510023608],
                [0.15247429464138412, -72.37438353921755, 127.19103912186281, -179.81344451617377, 54.81679861068753, 179.89250783612164],
                [0.1295662647250522, -72.35547781965073, 127.16413458685562, -179.84145731223967, 54.808760076814686, 179.9086305241453],
                [0.10424567314971274, -72.33930553367342, 127.1411145220185, -179.8724298536803, 54.80187588174737, 179.9264677769417],
                [0.06977097774566388, -72.32338534760153, 127.11844839640464, -179.91461098006297, 54.79509302148104, 179.95077300955742],
            ];
            this.currentRotationIndex = 127244;
            this.rotationInterval = 38; // 5초
            this.nextRotationTime = Date.now() + this.rotationInterval;

            this.updateRotations();
        },
        tick: function () {
            var currentTime = Date.now();
            if (currentTime >= this.nextRotationTime) {
                this.currentRotationIndex = (this.currentRotationIndex + 1) % this.rotationData.length;
                this.updateRotations();
                this.nextRotationTime = currentTime + this.rotationInterval;
            }
        },
        updateRotations: function () {
            var rotations = this.rotationData[this.currentRotationIndex];
            for (var i = 0; i < this.parts.length; i++) {
                var partId = this.parts[i];
                var rotation = rotations[i];
                var partEntity = document.querySelector("#" + partId);

                if (partId === 'R2') {
                    partEntity.setAttribute("rotation", "0 " + -rotation + " 0");
                } else if (partId === 'R3') {
                    partEntity.setAttribute("rotation", "0 0 " + -(rotation + 90));
                } else if (partId === 'R4') {
                    partEntity.setAttribute("rotation", "0 0 " + -(rotation - 90));
                } else if (partId === 'R5') {
                    partEntity.setAttribute("rotation", -rotation + " 0 0");
                } else if (partId === 'R6') {
                    partEntity.setAttribute("rotation", "0 0 " + -rotation);
                } else if (partId === 'R7') {
                    partEntity.setAttribute("rotation", -rotation + " 0 0");
                }
            }

            var p0Entity = document.querySelector("#P0");
            var modelPath = '/assets/public/models/3DP-3/';
            var modelIndex = this.currentRotationIndex;
            var flag = 0

            // modelIndex에 따라 모델 경로 설정
            if (modelIndex == 1310) {
                modelPath += '19';
                flag = 1
            } else if (modelIndex == 3820) {
                modelPath += '18';
                flag = 1
            } else if (modelIndex == 6285) {
                modelPath += '17';
                flag = 1
            } else if (modelIndex == 8697) {
                modelPath += '16';
                flag = 1
            } else if (modelIndex == 11155) {
                modelPath += '15';
                flag = 1
            } else if (modelIndex == 14229) {
                modelPath += '14';
                flag = 1
            } else if (modelIndex == 30977) {
                modelPath += '13';
                flag = 1
            } else if (modelIndex == 45604) {
                modelPath += '12';
                flag = 1
            } else if (modelIndex == 59084) {
                modelPath += '11';
                flag = 1
            } else if (modelIndex == 72692) {
                modelPath += '10';
                flag = 1
            } else if (modelIndex == 86390) {
                modelPath += '9';
                flag = 1
            } else if (modelIndex == 99591) {
                modelPath += '8';
                flag = 1
            } else if (modelIndex == 113600) {
                modelPath += '7';
                flag = 1
            } else if (modelIndex == 127244) {
                modelPath += '6';
                flag = 1
            } else if (modelIndex == 128423) {
                modelPath += '59';
                flag = 1
            } else if (modelIndex == 129622) {
                modelPath += '58';
                flag = 1
            } else if (modelIndex == 130832) {
                modelPath += '57';
                flag = 1
            } else if (modelIndex == 132042) {
                modelPath += '56';
                flag = 1
            } else if (modelIndex == 133229) {
                modelPath += '55';
                flag = 1
            } else if (modelIndex == 134447) {
                modelPath += '6';
                flag = 1
                this.currentRotationIndex = 127244;
            } else if (modelIndex == 154056) {
                modelPath += '4';
                flag = 1
            } else if (modelIndex == 173927) {
                modelPath += '3';
                flag = 1
            } else if (modelIndex == 197147) {
                modelPath += '2';
                flag = 1
            } else if (modelIndex == 220722) {
                modelPath += '1';
                flag = 1
            } else if (modelIndex == 239685) {
                modelPath += '0';
                flag = 1
            }

            if (flag == 1) {
                p0Entity.setAttribute("gltf-model", modelPath);
                // pixelContainer의 하위 sphere 삭제
                var pixelContainer = document.querySelector("#pixelContainer");
                var spheres = pixelContainer.querySelectorAll("a-box");

                for (var i = 0; i < spheres.length; i++) {
                    pixelContainer.removeChild(spheres[i]);
                }
            }


        }
    });

    document.querySelector("#B1").setAttribute("pixel-animation", {interval: 38, duration: 38000000});
    document.querySelector("#B1").setAttribute("robot-animation", {});
</script>
